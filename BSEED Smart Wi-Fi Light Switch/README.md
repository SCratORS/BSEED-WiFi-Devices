![image](https://github.com/user-attachments/assets/224a1033-6136-4f49-9e85-e455b62cd9f4)

# Разбираем выключатель

![image](https://github.com/user-attachments/assets/045a09a9-9cdc-4c57-9aa7-41b6025cf06b)

- Отсчелкиваем с металлической рамы, достаём модуль с кнопками.
- Откручиваем винтики, и аккуратно по его бокам отсчелкиваем крепления.

# Предупреждение

Выключатели могут быть с модулем BK7238 (T1-3S). По состоянию на 10.2025 платформа ESPHome их не поддерживает !!! Если Вам такой попался, - собираем всё назад. Дальше можно не читать.

# Коннектимся UART программатором

### Для 4-х кнопочных

![image](https://github.com/user-attachments/assets/d8513b9c-950b-46bb-a4d8-996a528d58d8)

### Для 1- и 3-х кнопочных

![image](https://github.com/user-attachments/assets/6c334c09-ab34-4447-a8e1-557f49f40205)

#### Для 2-х кнопочных придется снимать сам микроконтроллер с платы, т.к. пин ТХ используется как GPIO и без снятия общения с UART не происходит.

- Подцепляемся к контактам микроконтроллера
- Подцепляемся к пинам питания 3.3 и GND (нижний ряд, крайние справа). Прозвони по колодке где точно пины питания, на плате с реле есть стабилизатор питания - сверся с ним. Удостоверься в правильности.
- Слева от контактов питания можно подать +5, для питания светодиодов, но не обязательно.
- Верхние 4 пина это контакты управления реле. Они нам не нужны.
- Втыкаем программатор в USB порт компьютера.

# Прошиваем OpenBK

- Качаем и запускаем утилитку https://github.com/openshwprojects/BK7231GUIFlashTool

![image](https://github.com/user-attachments/assets/d9f28034-1b13-41ca-8773-a85b03a1ba58)

- Select UART port: выбираем определившийся COM порт UART программатора
- Select chip type: выбираем BK7231N
- Select firmware - кликаем туда, предложит скачать последнюю версию - соглашаемся.
- Нажимаем Do backup and flash new
- В открывшимся окне предложит ввести название устройства - жмём ОК, нам это не важно.
- В логах появится предложение замкнуть CEN пин на землю. Кратковременно замыкаем пин CEN на GND.
- Начнется процесс снятия бекапа и прошивки.

# Настраиваем Wi-Fi

- После успешной прошивки OpenBK, перезагружаем устройство по питанию.
- Открываем настройки Wi-Fi компьютера/смартфона/etc. находим и подключаемся к появившейся точке доступа устройства. Название OpenBK***.
- Переходим в браузере по адресу 192.168.4.1, и попадаем в настройки OpenBK.
- Идем в конфигурацию WiFi и подключаем устройство к домашней Wi-Fi сети.

# Прошиваем ESPHome

- Компилируем прошивку ESPHome. Install - Manual Download - Beken OTA Image (For flashing using Beken or OpenBeken OTA)
- Переходим в браузере по адресу устройства.
- Там находим OTA Update, выбираем скаченный файл прошивки *.rbl и жмякаем UPDATE.
- Ждём окончания процесса и автоматической перезагрузки.



